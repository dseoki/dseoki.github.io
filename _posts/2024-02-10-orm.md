---
title: ORM (Object Relational Mapping)
summary: ORM (Object Relational Mapping)ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì.
categories: [db]
comments: true
---

## ORM(Object Relational Mapping) ì´ë€?
ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ë¥¼ ë§¤í•‘í•´ì£¼ëŠ” ê¸°ìˆ ì´ë‹¤. ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê°ì²´ì™€ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‚¬ìš©ë˜ëŠ” í…Œì´ë¸” ê°„ì˜ ë¶ˆì¼ì¹˜ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ë°©ë²• ì¤‘ í•˜ë‚˜ì´ë‹¤.

ì´ì „ì— MyBatisë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° java í´ë˜ìŠ¤ ì½”ë“œì™€ ì§ì ‘ ì‘ì„±í•œ SQLì„ ë§¤íŒ½ ì‹œì¼œì£¼ì–´ì•¼ í–ˆë‹¤. JPA(Java Persistent API)ì™€ ê°™ì€ ORMì€ ê°ì²´ê°€ DBì— ì—°ê²°ë˜ê¸° ë•Œë¬¸ì—, SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³  í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.

ì „ì„¸ê³„ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•˜ëŠ” Hibernateê°€ ëŒ€í‘œì ì´ë‹¤.\
JPAë¥¼ ì‚¬ìš©í•˜ë©´ í†µê³„ë‚˜ ë™ì  ì¿¼ë¦¬ ê°™ì€ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì–´ë ¤ìš°ë¯€ë¡œ QueryDSLì„ í•¨ê»˜ ì´ìš©í•œë‹¤.

#### ğŸ”— jdbc í™œìš©í•œ ì½”ë“œ
```java
public void insertUser(User user){
    String query = " INSERT INTO user (email, name, pw) VALUES (?, ?, ?)";

    PreparedStatement preparedStmt = conn.prepareStatement(query);
    preparedStmt.setString (1, user.getEmail());
    preparedStmt.setString (2, user.getName());
    preparedStmt.setString (3, user.getPW());
    preparedStmt.execute();
}
```

#### ğŸ”— MyBatis í™œìš©í•œ ì½”ë“œ
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.blog.user.userMapper">

    <insert id="insertUser" parameterType = "user">
        INSERT USER
        (
            email, name, pw, 
        ) VALUES(
            #{email}, #{name}, #{pw}
        )
    </insert>

</mapper>
```

#### JPA í™œìš©í•œ ì½”ë“œ
```java
@Entity
@Table(name = "user")
@Getter
@Builder
@NoArgsConstructor(force = true)
@AllArgsConstructor
public class User extends BaseEntity {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String email;
    private String name;
    private String pw;
}
```
DBì™€ ë§¤í•‘ ì‹œí‚¤ê¸° ìœ„í•œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. `@Entity` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ í´ë˜ìŠ¤ê°€ ë°ì´í„°ë² ì´ìŠ¤ì˜ íŠ¹ì • í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤.\
`@Table` ì–´ë…¸í…Œì´ì…˜ì€ íŠ¹ì • í…Œì´ë¸”ì„ ì§€ì •í•œë‹¤.

```java
public interface UserRepository extends JpaRepository <User, Long> {

}
```
ORMì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ìœ„ì™€ ê°™ì´ Repositoryë¥¼ êµ¬í˜„í•œë‹¤. JPAì—ì„œ ê¸°ë³¸ì ì¸ CRUDë¥¼ ì œê³µí•˜ê³  ìˆì–´ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê²½ìš° save()ë¥¼ í˜¸ì¶œí•˜ê¸°ë§Œ í•˜ë©´ ëœë‹¤.

```java
@Service
@RequiredArgsConstructor
@Transactional(readonly = true)
public class UserService {

    private final UserRepository userRepository;

    @Transactional
    public User findUserAndUpdateName(Long id) {
        User user = userRepository.findById(id);
        user.setName("ë³€ê²½ëœ ì´ë¦„");
    }
}
```
ìœ„ì˜ ì½”ë“œì—ì„œ updateí•˜ëŠ” ì½”ë“œê°€ ë³´ì´ì§€ ì•Šì§€ë§Œ í…Œì´ë¸”ì˜ ë°ì´í„°ëŠ” ë³€ê²½ì´ ëœë‹¤.
`@Transactional` ì–´ë…¸í…Œì´ì…˜ì€ ë©”ì„œë“œê°€ ì‹¤í–‰ë  ë•Œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³ , ë©”ì„œë“œê°€ ì •ìƒì ìœ¼ë¡œ ì¢…ë£Œë  ë•Œ í•´ë‹¹ íŠ¸ëœì­ì…˜ì„ ì»¤ë°‹í•œë‹¤. ì´ ë•Œë¬¸ì— ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ëŠ” ë™ì•ˆì˜ ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…ì€ íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ìˆ˜í–‰ëœë‹¤.

ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ë³€ê²½ëœ ì—”í‹°í‹°ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ê´€ë¦¬ë˜ë©°, íŠ¸ëœì­ì…˜ì´ ì»¤ë°‹ë˜ëŠ” ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ì‚¬í•­ì´ ë°˜ì˜ëœë‹¤. ë”°ë¼ì„œ ì¡°íšŒ í›„ ìˆ˜ì •ì„ ë”°ë¡œ í•˜ì§€ ì•Šì•„ë„ ë°ì´í„°ë² ì´ìŠ¤ì˜ ë°ì´í„°ê°€ ë³€ê²½ë˜ëŠ” ê²ƒì€ `ì˜ì†ì„±` ë•Œë¬¸ì´ë‹¤.

> #### ì˜ì†ì„±(Persistence)
> ë°ì´í„°ì˜ ìƒíƒœê°€ ì§€ì†ë˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì£¼ë¡œ ê°ì²´ ì§€í–¥ í”„ë¡œê·¸ë˜ë°ì—ì„œ ì‚¬ìš©ë˜ë©°, ê°ì²´ì˜ ìƒíƒœê°€ ë©”ëª¨ë¦¬ì—ì„œ ìœ ì§€ë˜ëŠ” ë™ì•ˆ ê·¸ ê°ì²´ë¥¼ ì˜ì†ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ëŠ” ê²ƒì„ ë§í•œë‹¤.

